<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JaswineSSO | 登录</title>
    <link rel="stylesheet" type="text/css" href="css/login/styles.css">
    <!--[if IE]>
    <script src="http://libs.baidu.com/html5shiv/3.7/html5shiv.min.js"></script>
    <![endif]-->
    <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
    <script src="js/layui-v2.4.1/layui.all.js"></script>
    <script src="js/config.js"></script>
</head>
<body>
<div class="jq22-container" style="padding-top:100px">
    <div class="login-wrap">
        <div class="login-html">
            <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1" class="tab">登录</label>
            <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">注册</label>
            <div class="login-form">
                <div class="sign-in-htm">
                    <div class="group">
                        <label for="login_user" class="label">用户名</label>
                        <input id="login_user" type="text" class="input">
                    </div>
                    <div class="group">
                        <label for="login_pass" class="label">密码</label>
                        <input id="login_pass" type="password" class="input" data-type="password">
                    </div>
                    <div class="group">
                        <input id="check" type="checkbox" class="check" checked>
                        <label for="check"><span class="icon"></span>记住我</label>
                    </div>
                    <div class="group">
                        <input id="login_btn" type="submit" class="button" value="登录">
                    </div>
                    <div class="hr"></div>
                </div>
                <div class="sign-up-htm">
                    <div class="group">
                        <label for="logup_user" class="label">用户名</label>
                        <input id="logup_user" type="text" class="input">
                    </div>
                    <div class="group">
                        <label for="logup_pass" class="label">密码</label>
                        <input id="logup_pass" type="password" class="input" data-type="password">
                    </div>
                    <div class="group">
                        <label for="logup_passre" class="label">再次输入密码</label>
                        <input id="logup_passre" type="password" class="input" data-type="password">
                    </div>
                    <div class="group">
                        <label for="logup_email" class="label">邮箱地址</label>
                        <input id="logup_email" type="text" class="input">
                    </div>
                    <div class="group">
                        <input id="logup_btn" type="submit" class="button" value="注册">
                    </div>
                    <div class="hr"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        // token登录
        loinByToken();
        // 点击登录
        $("#login_btn").click(function () {
            loginByusernameAndPassword();
        });
        // 点击注册
        $("#logup_btn").click(function () {
            registerUser();
        })
    });
    // 0.token登录
    const loinByToken = function () {
        const token = localStorage.getItem("token");
        if (token != "" | token != null) {
            $.ajax({
                url: httpUrl + "/user/preLogin",
                method: "POST",
                data: token,
                contentType: "application/json",
                dataType: "json",
                success: function (res) {
                    console.log(res);
                }
            })
        }
    };
    // 1.用户名密码登录
    const loginByusernameAndPassword = function () {
        const username = $.trim($("#login_user").val());
        const password = $.trim($("#login_pass").val());

        if (username != null && password != null) {
            const user = {
                username: username,
                password: password
            };

            $.ajax({
                url: httpUrl + "/login",
                method: "POST",
                data: JSON.stringify(user),
                contentType: "application/json",
                dataType: "json",
                success: function (res) {
                    if (res.status == 0) {
                        layer.msg(res.msg);
                        localStorage.setItem("token", res.data);
                        setTimeout(function () {
                            window.location.href = "index.html";
                        }, 2000);
                    } else {
                        layer.msg(res.msg);
                    }
                }
            })
        } else {
            layer.msg("用户名或者密码为空...")
        }
    };

    // 2.注册
    const registerUser = function () {
        const username = $.trim($("#logup_user").val());
        const password = $.trim($("#logup_pass").val());
        const repassword = $.trim($("#logup_passre").val());
        const email = $.trim($("#logup_email").val());
        if (password != repassword) {
            layer.msg("两次密码输入不一致...");
        } else {
            const user = {
                username: username,
                password: password,
                email: email
            };

            $.ajax({
                url: httpUrl + "/registerUser",
                method: "POST",
                data: JSON.stringify(user),
                contentType: "application/json",
                dataType: "json",
                success: function (res) {
                    if (res.status == 0) {
                        layer.msg(res.msg);
                        localStorage.setItem("token", res.data);
                        setTimeout(function () {
                            window.location.href = "index.html";
                        }, 2000);
                    } else {
                        layer.msg(res.msg);
                    }
                }
            })
        }
    }
</script>
</body>
</html>